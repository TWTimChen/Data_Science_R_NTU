{
    "collab_server" : "",
    "contents" : "library(httr)\nlibrary(XML)\nlibrary(magrittr)\nlibrary(tidyverse)\n\n# 7-11\nurl = 'http://emap.pcsc.com.tw/EMapSDK.aspx'\npostData = list(commandid='SearchStore',\n                city='台北市',\n                town='信義區')\nres = POST(url = url,body = postData)\ndf = res %>% content(as='text') %>% xmlParse %>% .[\"//GeoPosition\"] %>% \n  xmlToDataFrame() %>% View\n\n# yahoo stock\nurl = 'https://tw.stock.yahoo.com/d/s/major_2451.html'\nhtml = url %>% GET %>% content(encoding = \"big5\",as = 'text') %>% \n  htmlParse(encoding = 'utf8')\n\ntable = readHTMLTable(html)\ntable[[10]] %>% View\n\n\n# ppt\nhtml = GET(url = 'https://www.ptt.cc/bbs/Gossiping',set_cookies(over18=1)) %>% \n  content(as = 'text') %>% htmlParse\n\ndate = html[\"//div[@class='meta']/div[@class='date']\"] %>% \n  xmlApply(function(node) xmlValue(node))\n\nauthor = html[\"//div[@class='meta']/div[@class='author']\"] %>% \n  xmlApply(function(node) xmlValue(node))\n\ntitle = html[\"//div[@class='title']/a\"] %>% \n  xmlApply(function(node) xmlValue(node))\n\nhref = html[\"//div[@class='title']/a\"] %>% \n  xmlApply(function(node) xmlAttrs(node,'href'))\n\ncbind(date,title,author,href) %>% data.frame %>% View()\n\nhtml1 = GET(url = 'https://www.ptt.cc/bbs/Gossiping/M.1505370851.A.750.html',\n    set_cookies(over18=1)) %>% \n  content(as = 'text') %>% htmlParse\n\nhtml1 %>% .[\"//div[@class='push']\"] \n\n# google map api\naddress = list(\"台灣大學\",\"建國中學\",\"永和國中\",\"秀山國小\")\nurlAPI = \"https://maps.googleapis.com/maps/api/geocode/json\"\nkey = \"AIzaSyCT9Qvbt598NA9-qUt3sWHpTo_jP5j_Wvc\"\n\nlookUpGIS = function(address,key){\n  urlAPI = \"https://maps.googleapis.com/maps/api/geocode/json\"\n  urlAPI %>% GET(query = list(address=address[[1]],key=key)) %>%\n  content()\n}  \n\nres = lookUpGIS(address = address[[1]],key=key) \nres %>% .content$results[[1]]$geometry$location\n\nreses = map(address,lookUpGIS,key=key) \nreses %>% \n  map(function(content) content$results[[1]]$geometry$location) %>% \n  do.call(rbind,.) %>% cbind(address)\n\n# hk711 api\nhk711api = \"https://www.7-eleven.com.hk/api/store\"\ndf = hk711api %>% GET %>% content %>% \n  .$data %>% do.call(rbind,.) %>% \n  data.frame()\ndf %>% View\ndf %<>% mutate(rid = row_number())\n\ngeoDf = df$Geolocation %>% do.call(rbind,.) %>% \n  data.frame() %>% cbind(rid = df$rid,.)\ngeoDf %>% View\n\nstoreDf = df$Store %>% do.call(rbind,.) %>% \n  data.frame() %>% cbind(rid = df$rid,.)\nstoreDf %>% View\n\nfinalDf = df %>% select(-c(Geolocation,Store)) %>% \n  inner_join(geoDf) %>% inner_join(storeDf)\n\nfinalDf$Services %<>% map(function(x) data.frame(do.call(rbind,x)))\nservicesDf = finalDf %>% select(rid,Services) %>% unnest\nfinalDf$Services\nfinalDf %>% \n  ggplot(mapping = aes(as.character(Region))) + geom_bar()\n\nservicesDf %>% ggplot(mapping = aes(as.character(Name))) + geom_bar()\nservicesDf %>% group_by(rid) %>% summarise(m = n()) %>% \n  ggplot(mapping = aes(m)) + geom_bar()\n\n\n",
    "created" : 1527558547429.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1433140826",
    "id" : "AB8C0681",
    "lastKnownWriteTime" : 1520600583,
    "last_content_update" : 1520600583,
    "path" : "~/Desktop/R /environment-testing-r/crawler_notes.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}